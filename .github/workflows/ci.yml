name: CI for sskcp 
on:
  push:
    branches:
      - master
      - develop
    tags: 
      - '[0-9]+.[0-9]+.[0-9]+'
jobs:
  ci:
    strategy:
      matrix:
        arch: [armv6, x86]
    runs-on: ubuntu-latest
    steps:
      - name: pull repo
        uses: actions/checkout@v3
      - name: create image and zip
        run: |
          docker version
          make mk-image ARCH=${{ matrix.arch }}  
          make mk-deployment VERSION=${{ github.ref_name }}
        shell: bash
      - name: release a new version
        if: startsWith(github.ref, 'refs/tags/')
        uses: marvinpinto/action-automatic-releases@latest
        with:
          repo_token: "${{ secrects.GITHUB_TOKEN }}"
          prerelease: true
          files: |
            *.zip
