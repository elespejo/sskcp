language: generic
sudo: required
dist: trusty
env:
  matrix:
  - ARCH=armv6
  - ARCH=x86
  global:
  - secure: p45M3or+Mo8A2yCtiUpkLInyigO0UE4R26Mpx9bEd2RDIillhFlHeK4EFsGjT7GI4QFz2nrfPvyQfmHlw3Tb5ZxtIC5nb2qonoh4mUF9A2LgWCXYISYttW6msuMREU5iTBzdDY1Ki6cRGUuO505Vp3oGrQQ5OwmwYg8vdS8fSajpXjQLJdZOlXdnSeSvbRB6PakXe7G5FcKy4imwp/f1gU3IejwbLv8TJT8ogk68qeyf6fUhL1yPYeddX+giqrOUzqVBZphDjaEvrGWBIZ+xau2zwBap5PYCU3v2Z50MCw7uTP3g3ST0STXHGGPvfm7PJv6wBKMhrroakV8uykxW4Q4DalCvRMhTX+EYHxpyOtZ2RuvzbkskRBX09XQlvcq9VfJI8OoqzXs//VCxouhEpFk1kP/70O+eBUDXKRmI7GoYw+1dbO3zzn9bEwD0711iCp9cU31fJz846eE5mo6IQtcq+m1x2ZJkl1GiPinjKSjnZUR42WMve/kAGFQzvmOpy5uf4E56Yn7EoQq2DT521FWNO48X7XBLsUM3b2+CqPGBJu4bef1kAwTMiDp3dUAN/DuWMB9mC9ZZ0dLOqLTRO/4NXMRNvCNQUQkwHBi0Ti7AHXokdpnNVbMc4ur1cxG0DI0xV2QFSD3wKfhrk+vOS6/HpRPE0RdyaqlO8PzDYwU=
  - secure: XUc4GItVlBmAuAmch1doDgWqFZi3PNr17kI9oVdHLmGaMisb+f6sOtbQ43RFpV+Ul2dow5NtVM73jMLF0SbHVQsT58a8GltHZSr8Ll67y/vKRTFlqhKbcTay+TjrC2urs0QYu0UE8JAF+kegdXeVMc5460Z6jWDMaiuh2TD8I01lntfnQGSQh1DY1dqBOQ6DVjiAdWAfhDEoUZFqR8GDsMUUjk3S4u5rjeSDwCgtPJOBktVl7rS7VBZilzyulj+7/uAiSJfUaDCCLFR/xNTY7PHu4NtHswaNTJKVBvFoheG4qaywE8Nl8Wi1Oa3H5fjSGMfdDTo8KyUua1XsgTV/JPImDy+Eb/Ddw1JMoyc9GpnCaI+jUl+jE4uc+QiCvqLLMhQiU0+h33A90QM+WZMplFsCmTLq8tkrqZQNT5krifP26ifu+zCwhMNZ+JL4ADcb3eMeR2SnhW4SsAFPYs2N79mVO9qtlJqUu1+i4wO2aNowlDb8XKQvbK1gR4ouoM2+dqu4tYkpjUDmNxgD31s6EJzSo4iSVZ6iR+cAvN81nIxJg3juvFX8qODlAov3dFKKfQxvCPb8oM6x7usnVK2XVCH1zPUY9wc+CfVX7hyBqZCAo/GUY9Il6VFtT8kvb+/CvBxsrNSavp+qKkZM6qbN22+hR+p4mhT2Z/na3gosLZ4=
services:
- docker
branches:
  only:
  - master
  - develop
  - "/^\\d+\\.\\d+(\\.\\d+)?(-\\S*)?$/"
install: true
script:
- make mk-image ARCH=$ARCH
- make mk-deployment VERSION=$TRAVIS_TAG
deploy:
  - provider: script
    script: make pushtohub DOCKER_USER=$DOCKER_USER DOCKER_PASS=$DOCKER_PASS ARCH=$ARCH
      TAG=$TRAVIS_BRANCH
    on:
      all_branches: true
      condition: "$TRAVIS_BRANCH =~ ^master|develop$"
  - provider: script
    script: make pushtohub DOCKER_USER=$DOCKER_USER DOCKER_PASS=$DOCKER_PASS ARCH=$ARCH
      TAG=$TRAVIS_TAG
    on:
      tags: true
      all_branches: true
  - provider: releases
    prelease: true
    skip_cleanup: true
    file_glob: true
    file: "./*.zip"
    on:
      tags: true
      all_branches: true
    user:
      secure: Tn2iYBfbNUM8UvZ2NxPHcJiKJ1raae0QrKbJZyePbZYTqtAWtjQ1EQV0pl+uoOav0i3wS7CN+fjXfFbRbdjwX0yr4k8gC7lpWbj105T/DQ4cXymXPuzgb+9vpD8ujR+o8IrDxW56mcV5eNez31toForSWOpORzn8L9o2IisXl7pbTzeX2IyFcg/i33LHansu24BSyeZm/7z946peHbtG+yMBhe+0jQllAO7z/iGu9FMfmBK20Y8xdbF6TENJBIFMKvNkysCPx7a9/jJu5hNSZrVsGt3IFXGEGzWm/RNTlAwEs+v8aUFROPkV3TCdN9KnOhkoexWNDPIceDHLqX/o1VegBXGDZeKLuYZCR9Lcwkbracc0uFV2rJa1ndnbK4B65KnnDinw2P45Xah0JGuYsQO04Gacx1UAWMaIGhQehs4XTd+jGKFr9qhFxBK+p4JAdukzESQL8qt2scSkenxEOwdAIVFGQDfTmwoyP+AHuZ74bvTiqBvm+0nqgUwsnAfwolDPHdsNHBEO675k2QVd5UKj4qTHUzi3bsLgBT03eHfePRV2vMgU2e6UYP3HmyxzXivk2lW175/KEoXUBPGT5xeuitd3387y6VQTg5rH6upfxaBLDunHNSpR0k+tBTvwtxmeZyT+G2vamt8ROggzTvY23KgqkRe4Gk3GvB7amqU=
    password:
      secure: Nu+9NxJXyVF6PeQcAk0si4M5SmwlLRCk3Phh2fibln10tfmqpQ/TVREEs7x3cVCc8y81kybhMNkJqQEYbup6akOzXUDobXBdAv8rDu2fw1hgeb05QgqFElKYy4Ndzz+fXkm2WZeMM2Ex32dA3YQm343IvnR6lG2K7aC2H0X3fxF2Rns40BC+WlkZkxAkiThgm4HnGupG2mJ021MVDmfmxVUyAdx1otprKu9UZ/8/vo7v/b+K55AR4OZwhomIZlKxEdYMUfvDooZXDCxIZeJ8tfbjLXrRc3rjMZNWPjgOQJ5esPsKP6TZa95QFiQ0MJDLcrv2z26C3Rj0QahXTTKSEhF/iLt7fs/UfAdFp7k7C6ilXtm2MnPyb994jlprz4dHkqHUEaeiimHUrpStp90wYZJpMFOToR/vDvNYZbYdinoNX9xdrRm1tMv8UMBHPcWUPu2F59PgdniOaqTSlxT1hT5SB/2idmFcOuRiFIJt2Gwwh1k1I7XKfVhd/RWMBA/Gs1hzcaxo3sGR7iDHZm2712fzNFNEs/FPck7NotL0rr2hMMuMLy7Qu+M1S5QnZ3rogjsnVvOdbBaAKCmEjatgdODqghcssMKXVHLzNwIPy1DR0O8SeUkAmxKFHtJKPsYLuRs+PQjtWxlyzLB/xGvUWji5Ofr1iGwBSK4OKUsmStI=